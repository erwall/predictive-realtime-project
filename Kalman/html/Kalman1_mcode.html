<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T30U3">return_value</span> ] = Kalman(<span class="var type1" id="S3T13U6">option</span>,<span class="var type1" id="S4T2U7">y1</span>,<span class="var type1" id="S5T2U8">y2</span>,<span class="var type1" id="S6T2U9">u1</span>,<span class="var type1" id="S7T2U10">u2</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%UNTITLED2 Summary of this function goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%only designed for starting in 10 state -&gt;16 and then staying there.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%Starting in 16 might work to but no thought have been put into it.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="var type1" id="S8T8U13">Phi</span> = <span class="mxinfo" id="T8:U9">[3.111 0.429 1 0 0 0 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    0.08268 2.794 0 1 0 0 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    -3.182 -0.9092 0 0 1 0 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    -0.2245 -2.631 0 0 0 1 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    0.8211 0.3671 0 0 0 0 1 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    0.1541 0.8153 0 0 0 0 0 1 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    0.455 0.2896 0 0 0 0 0 0 1 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    0.02951 0.06612 0 0 0 0 0 0 0 1;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    -0.2051 -0.1762 0 0 0 0 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    -0.04261 -0.04461 0 0 0 0 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T8:U9">    ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="var type1" id="S9T18U135">Gamma</span> = <span class="mxinfo" id="T18:U12">[0.0008364 -0.0004057;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0.0008679 -0.0001901;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0.0009015 -0.0009729;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0.0006347 -0.00009547;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0.001133 0.002063;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    -0.002024 0.0000549;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    -0.001292 -0.0003008;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0.0003297 -0.0003316;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">    0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="mxinfo" id="T18:U12">   ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T17:U13"><span class="var type1" id="S10T17U177">C</span> = <span class="mxinfo" id="T17:U15">[1 0 0 0 0 0 0 0 0 0;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T17:U13"><span class="mxinfo" id="T17:U15">    0 1 0 0 0 0 0 0 0 0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo" id="T12:U16"><span class="var type1" id="S11T12U203">Phi2</span> = <span class="mxinfo" id="T12:U18">[3.11100000000000,0.429000000000000,1,0,0,0,0,0,0,0,0,0,0.000836400000000000,-0.000405700000000000,1,0;0.0826800000000000,2.79400000000000,0,1,0,0,0,0,0,0,0,0,0.000867900000000000,-0.000190100000000000,0,1;-3.18200000000000,-0.909200000000000,0,0,1,0,0,0,0,0,0,0,0.000901500000000000,-0.000972900000000000,0,0;-0.224500000000000,-2.63100000000000,0,0,0,1,0,0,0,0,0,0,0.000634700000000000,-9.54700000000000e-05,0,0;0.821100000000000,0.367100000000000,0,0,0,0,1,0,0,0,0,0,0.00113300000000000,0.00206300000000000,0,0;0.154100000000000,0.815300000000000,0,0,0,0,0,1,0,0,0,0,-0.00202400000000000,5.49000000000000e-05,0,0;0.455000000000000,0.289600000000000,0,0,0,0,0,0,1,0,0,0,-0.00129200000000000,-0.000300800000000000,0,0;0.0295100000000000,0.0661200000000000,0,0,0,0,0,0,0,1,0,0,0.000329700000000000,-0.000331600000000000,0,0;-0.205100000000000,-0.176200000000000,0,0,0,0,0,0,0,0,0,0,0,0,0,0;-0.0426100000000000,-0.0446100000000000,0,0,0,0,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0;0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0;0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0;0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0;0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1;]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T29:U19"><span class="var type1" id="S12T29U495">Gamma2</span> = <span class="mxinfo" id="T29:U21">[0.000836400000000000,-0.000405700000000000;0.000867900000000000,-0.000190100000000000;0.000901500000000000,-0.000972900000000000;0.000634700000000000,-9.54700000000000e-05;0.00113300000000000,0.00206300000000000;-0.00202400000000000,5.49000000000000e-05;-0.00129200000000000,-0.000300800000000000;0.000329700000000000,-0.000331600000000000;0,0;0,0;0,0;0,0;0,0;0,0;0,0;0,0;]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T28:U22"><span class="var type1" id="S13T28U555">C2</span> = <span class="mxinfo" id="T28:U24">[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0;0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0;]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">    <span class="mxinfo" id="T8:U25"><span class="var type1" id="S14T8U593">Q</span> = <span class="mxinfo" id="T8:U27">5*diag([1,1,ones(1,8)*1])</span></span>; <span class="comment">%State covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo" id="T10:U28"><span class="var type1" id="S17T10U610">R</span> = <span class="mxinfo" id="T10:U30">1*diag([1,1])</span></span>; <span class="comment">%output covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">    <span class="mxinfo" id="T12:U31"><span class="var type1" id="S18T12U621">Q_e</span> = <span class="mxinfo" id="T12:U33">5*diag([1,1,ones(1,8)*1,0.5*ones(1,2),0.5*ones(1,2),0.1*ones(1,2)])</span></span>; <span class="comment">%State covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo" id="T10:U34"><span class="var type1" id="S19T10U656">R_e</span> = <span class="mxinfo" id="T10:U36">1*diag([1,1])</span></span>; <span class="comment">%output covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S20T23U666">xhat</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S21T23U668">xhatm</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S22T30U670">xhatm_e</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S23T30U672">xhat_ext</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S24T8U674">Pp</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S25T12U676">Pp_ext</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S26T18U678">K</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S27T29U680">K_e</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S28T8U682">Pm</span>; <span class="comment">%Should save memory allocation?</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S29T12U684">Pm_e</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S30T2U686">init_10</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S31T2U688">init_16</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S32T2U690">init_extended</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U50"><span class="mxinfo" id="T7:U51">isempty(<span class="var type2" id="S20T0U695">xhat</span>)</span></span> <span class="comment">%First function call.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">    <span class="mxinfo" id="T23:U52"><span class="var type1" id="S20T23U698">xhat</span> = <span class="mxinfo" id="T23:U54">zeros(<span class="mxinfo" id="T2:U55">10</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo" id="T8:U56"><span class="var type1" id="S24T8U705">Pp</span> = <span class="mxinfo" id="T8:U58">diag(<span class="mxinfo" id="T3:U59">ones(1,10)*1000</span>)</span></span>; <span class="comment">%initial covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo" id="T23:U60"><span class="var type1" id="S21T23U716">xhatm</span> = <span class="mxinfo" id="T23:U62">zeros(<span class="mxinfo" id="T2:U63">10</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo" id="T30:U64"><span class="var type1" id="S22T30U723">xhatm_e</span> = <span class="mxinfo" id="T30:U66">zeros(<span class="mxinfo" id="T2:U67">16</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">    <span class="mxinfo" id="T18:U68"><span class="var type1" id="S26T18U730">K</span> = <span class="mxinfo" id="T18:U70">zeros(<span class="mxinfo" id="T2:U71">10</span>,<span class="mxinfo" id="T2:U72">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">    <span class="mxinfo" id="T29:U73"><span class="var type1" id="S27T29U737">K_e</span> = <span class="mxinfo" id="T29:U75">zeros(<span class="mxinfo" id="T2:U76">16</span>,<span class="mxinfo" id="T2:U77">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">    <span class="mxinfo" id="T2:U78"><span class="var type1" id="S30T2U744">init_10</span> = <span class="mxinfo" id="T2:U80">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo" id="T2:U81"><span class="var type1" id="S31T2U748">init_16</span> = <span class="mxinfo" id="T2:U83">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">    <span class="mxinfo" id="T2:U84"><span class="var type1" id="S32T2U752">init_extended</span> = <span class="mxinfo" id="T2:U86">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">    <span class="mxinfo" id="T12:U87"><span class="var type1" id="S25T12U756">Pp_ext</span> =<span class="mxinfo" id="T12:U89">diag(<span class="mxinfo" id="T11:U90">ones(1,16)*1000</span>)</span></span>; <span class="comment">%Will be reinitalized alter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">    <span class="mxinfo" id="T30:U91"><span class="var type1" id="S23T30U767">xhat_ext</span> = <span class="mxinfo" id="T30:U93">zeros(<span class="mxinfo" id="T2:U94">16</span>,1)</span></span>;<span class="comment">%Will be reinitalized alter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%Fix inputs.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo" id="T24:U95"><span class="var type1" id="S35T24U774">y</span> = <span class="mxinfo" id="T24:U97">[<span class="var type1" id="S4T2U777">y1</span>;<span class="var type1" id="S5T2U779">y2</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo" id="T24:U100"><span class="var type1" id="S36T24U782">u</span> = <span class="mxinfo" id="T24:U102">[<span class="var type1" id="S6T2U785">u1</span>;<span class="var type1" id="S7T2U787">u2</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U105"><span class="var type1" id="S3T13U791">option</span> == <span class="mxinfo" id="T2:U107">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%update prediction 10 states</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">    <span class="mxinfo" id="T2:U108"><span class="var type1" id="S30T2U795">init_10</span> = <span class="mxinfo" id="T2:U110">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">    <span class="mxinfo" id="T23:U111"><span class="var type1" id="S21T23U799">xhatm</span> = <span class="mxinfo" id="T23:U113">zeros(<span class="mxinfo" id="T2:U114">10</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">    <span class="mxinfo" id="T8:U115"><span class="var type1" id="S28T8U806">Pm</span> = <span class="mxinfo" id="T8:U117"><span class="mxinfo" id="T8:U118"><span class="mxinfo" id="T8:U119"><span class="var type1" id="S8T8U810">Phi</span>*<span class="var type1" id="S24T8U811">Pp</span></span>*<span class="var type1" id="S8T8U813">Phi</span>'</span>+<span class="var type1" id="S14T8U814">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">    <span class="mxinfo" id="T18:U124"><span class="var type1" id="S26T18U817">K</span> = <span class="mxinfo" id="T18:U126"><span class="mxinfo" id="T18:U127"><span class="var type1" id="S28T8U820">Pm</span>*<span class="var type1" id="S10T17U822">C</span>'</span>*<span class="mxinfo" id="T10:U130">inv(<span class="mxinfo" id="T10:U131"><span class="mxinfo" id="T10:U132"><span class="mxinfo" id="T17:U133"><span class="var type1" id="S10T17U828">C</span>*<span class="var type1" id="S28T8U829">Pm</span></span>*<span class="var type1" id="S10T17U831">C</span>'</span>+<span class="var type1" id="S17T10U832">R</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">    <span class="mxinfo" id="T23:U138"><span class="var type1" id="S21T23U835">xhatm</span> = <span class="mxinfo" id="T23:U140"><span class="mxinfo" id="T23:U141"><span class="var type1" id="S8T8U838">Phi</span>*<span class="var type1" id="S20T23U839">xhat</span></span>+<span class="mxinfo" id="T23:U144"><span class="var type1" id="S9T18U841">Gamma</span>*(<span class="mxinfo" id="T24:U146"><span class="var type1" id="S36T24U844">u</span>-<span class="mxinfo" id="T24:U148"><span class="mxinfo" id="T9:U149">[<span class="mxinfo" id="T2:U150">2.7</span> <span class="mxinfo" id="T2:U151">4.3</span>]</span>'</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">    <span class="comment">%precompute</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">    <span class="mxinfo" id="T8:U152"><span class="var type1" id="S24T8U852">Pp</span> = <span class="mxinfo" id="T8:U154">(<span class="mxinfo" id="T8:U155"><span class="mxinfo" id="T8:U156">eye(10,10)</span>-<span class="mxinfo" id="T8:U157"><span class="var type1" id="S26T18U861">K</span>*<span class="var type1" id="S10T17U862">C</span></span></span>)*<span class="var type1" id="S28T8U863">Pm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">    <span class="comment">%Symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo" id="T8:U161"><span class="var type1" id="S24T8U866">Pp</span> = <span class="mxinfo" id="T8:U163">(<span class="mxinfo" id="T8:U164"><span class="var type1" id="S24T8U870">Pp</span>+<span class="mxinfo" id="T8:U166"><span class="var type1" id="S24T8U872">Pp</span>'</span></span>)/<span class="mxinfo" id="T2:U168">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">    <span class="mxinfo" id="T30:U169"><span class="var type1" id="S2T30U876">return_value</span> = <span class="mxinfo" id="T30:U171">[<span class="var type1" id="S20T23U879">xhat</span>;<span class="mxinfo" id="T31:U173">zeros(<span class="mxinfo" id="T2:U174">6</span>,1)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo" id="T7:U175"><span class="var type1" id="S3T13U887">option</span> == <span class="mxinfo" id="T2:U177">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="comment">%update measurement 10 states</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U178">~<span class="var type1" id="S30T2U892">init_10</span></span> <span class="comment">%This might give some very minor input-output delay for first function call</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">                 <span class="comment">%But doesnt let the user make mistakes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">        <span class="mxinfo" id="T2:U180"><span class="var type1" id="S30T2U895">init_10</span> = <span class="mxinfo" id="T2:U182">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">       <span class="mxinfo" id="T23:U183"><span class="var type1" id="S21T23U899">xhatm</span> = <span class="mxinfo" id="T23:U185">zeros(<span class="mxinfo" id="T2:U186">10</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">        <span class="mxinfo" id="T8:U187"><span class="var type1" id="S28T8U906">Pm</span> = <span class="mxinfo" id="T8:U189"><span class="mxinfo" id="T8:U190"><span class="mxinfo" id="T8:U191"><span class="var type1" id="S8T8U910">Phi</span>*<span class="var type1" id="S24T8U911">Pp</span></span>*<span class="var type1" id="S8T8U913">Phi</span>'</span>+<span class="var type1" id="S14T8U914">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">        <span class="mxinfo" id="T18:U196"><span class="var type1" id="S26T18U917">K</span> = <span class="mxinfo" id="T18:U198"><span class="mxinfo" id="T18:U199"><span class="var type1" id="S28T8U920">Pm</span>*<span class="var type1" id="S10T17U922">C</span>'</span>*<span class="mxinfo" id="T10:U202">inv(<span class="mxinfo" id="T10:U203"><span class="mxinfo" id="T10:U204"><span class="mxinfo" id="T17:U205"><span class="var type1" id="S10T17U928">C</span>*<span class="var type1" id="S28T8U929">Pm</span></span>*<span class="var type1" id="S10T17U931">C</span>'</span>+<span class="var type1" id="S17T10U932">R</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">        <span class="mxinfo" id="T23:U210"><span class="var type1" id="S21T23U935">xhatm</span> = <span class="mxinfo" id="T23:U212"><span class="mxinfo" id="T23:U213"><span class="var type1" id="S8T8U938">Phi</span>*<span class="var type1" id="S20T23U939">xhat</span></span>+<span class="mxinfo" id="T23:U216"><span class="var type1" id="S9T18U941">Gamma</span>*(<span class="mxinfo" id="T24:U218">[0 0]'-[2.7 4.3]'</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">        <span class="comment">%precompute</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">        <span class="mxinfo" id="T8:U219"><span class="var type1" id="S24T8U956">Pp</span> = <span class="mxinfo" id="T8:U221">(<span class="mxinfo" id="T8:U222"><span class="mxinfo" id="T8:U223">eye(10,10)</span>-<span class="mxinfo" id="T8:U224"><span class="var type1" id="S26T18U965">K</span>*<span class="var type1" id="S10T17U966">C</span></span></span>)*<span class="var type1" id="S28T8U967">Pm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">        <span class="comment">%Symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">        <span class="mxinfo" id="T8:U228"><span class="var type1" id="S24T8U970">Pp</span> = <span class="mxinfo" id="T8:U230">(<span class="mxinfo" id="T8:U231"><span class="var type1" id="S24T8U974">Pp</span>+<span class="mxinfo" id="T8:U233"><span class="var type1" id="S24T8U976">Pp</span>'</span></span>)/<span class="mxinfo" id="T2:U235">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    <span class="mxinfo" id="T23:U236"><span class="var type1" id="S20T23U980">xhat</span> = <span class="mxinfo" id="T23:U238"><span class="var type1" id="S21T23U982">xhatm</span>+<span class="mxinfo" id="T23:U240"><span class="var type1" id="S26T18U984">K</span>*(<span class="mxinfo" id="T24:U242"><span class="var type1" id="S35T24U987">y</span>-<span class="mxinfo" id="T24:U244"><span class="var type1" id="S10T17U989">C</span>*<span class="var type1" id="S21T23U990">xhatm</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">    <span class="mxinfo" id="T30:U247"><span class="var type1" id="S2T30U993">return_value</span> = <span class="mxinfo" id="T30:U249">[<span class="var type1" id="S20T23U996">xhat</span>;<span class="mxinfo" id="T31:U251">zeros(<span class="mxinfo" id="T2:U252">6</span>,1)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo" id="T7:U253"><span class="var type1" id="S3T13U1004">option</span> ==<span class="mxinfo" id="T2:U255">3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">%update prediction 16 states</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">    <span class="mxinfo" id="T2:U256"><span class="var type1" id="S31T2U1008">init_16</span> = <span class="mxinfo" id="T2:U258">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U259">~<span class="var type1" id="S32T2U1013">init_extended</span></span> <span class="comment">%initalize </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line">        <span class="mxinfo" id="T2:U261"><span class="var type1" id="S32T2U1016">init_extended</span> = <span class="mxinfo" id="T2:U263">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">        <span class="mxinfo" id="T30:U264"><span class="var type1" id="S23T30U1020">xhat_ext</span> = <span class="mxinfo" id="T30:U266">zeros(<span class="mxinfo" id="T2:U267">16</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">        <span class="mxinfo" id="T3:U268"><span class="mxinfo" id="T3:U269"><span class="var type1" id="S23T30U1028">xhat_ext</span>(<span class="mxinfo" id="T23:U271"><span class="mxinfo" id="T2:U272">1</span>:<span class="mxinfo" id="T2:U273">10</span></span>)</span> = <span class="var type1" id="S20T23U1032">xhat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">        <span class="comment">% Predictor should be called first.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">        <span class="mxinfo" id="T12:U275"><span class="var type1" id="S25T12U1035">Pp_ext</span> = <span class="mxinfo" id="T12:U277">diag(<span class="mxinfo" id="T11:U278">[1 ,1 ,ones(1,8), 0.5*[1 1], 0.5*[1 1] , [0.1,0.1 ]]</span>)</span></span>; <span class="comment">%initial covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">        <span class="mxinfo" id="T8:U279"><span class="mxinfo" id="T8:U280"><span class="var type1" id="S25T12U1065">Pp_ext</span>(<span class="mxinfo" id="T23:U282"><span class="mxinfo" id="T2:U283">1</span>:<span class="mxinfo" id="T2:U284">10</span></span>,<span class="mxinfo" id="T23:U285"><span class="mxinfo" id="T2:U286">1</span>:<span class="mxinfo" id="T2:U287">10</span></span>)</span> = <span class="var type1" id="S24T8U1072">Pp</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">    <span class="mxinfo" id="T12:U289"><span class="var type1" id="S29T12U1075">Pm_e</span> = <span class="mxinfo" id="T12:U291"><span class="mxinfo" id="T12:U292"><span class="mxinfo" id="T12:U293"><span class="var type1" id="S11T12U1079">Phi2</span>*<span class="var type1" id="S25T12U1080">Pp_ext</span></span>*<span class="var type1" id="S11T12U1082">Phi2</span>'</span>+<span class="var type1" id="S18T12U1083">Q_e</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">    <span class="mxinfo" id="T29:U298"><span class="var type1" id="S27T29U1086">K_e</span> = <span class="mxinfo" id="T29:U300"><span class="mxinfo" id="T29:U301"><span class="var type1" id="S29T12U1089">Pm_e</span>*<span class="var type1" id="S13T28U1091">C2</span>'</span>/(<span class="mxinfo" id="T10:U304"><span class="mxinfo" id="T10:U305"><span class="mxinfo" id="T28:U306"><span class="var type1" id="S13T28U1096">C2</span>*<span class="var type1" id="S29T12U1097">Pm_e</span></span>*<span class="var type1" id="S13T28U1099">C2</span>'</span>+<span class="var type1" id="S19T10U1100">R_e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">    <span class="mxinfo" id="T30:U311"><span class="var type1" id="S22T30U1103">xhatm_e</span> = <span class="mxinfo" id="T30:U313"><span class="mxinfo" id="T30:U314"><span class="var type1" id="S11T12U1106">Phi2</span>*<span class="var type1" id="S23T30U1107">xhat_ext</span></span>+<span class="mxinfo" id="T30:U317"><span class="var type1" id="S12T29U1109">Gamma2</span>*(<span class="mxinfo" id="T24:U319"><span class="var type1" id="S36T24U1112">u</span>-<span class="mxinfo" id="T24:U321"><span class="mxinfo" id="T9:U322">[<span class="mxinfo" id="T2:U323">2.7</span> <span class="mxinfo" id="T2:U324">4.3</span>]</span>'</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">    <span class="mxinfo" id="T12:U325"><span class="var type1" id="S25T12U1120">Pp_ext</span> = <span class="mxinfo" id="T12:U327">(<span class="mxinfo" id="T12:U328"><span class="mxinfo" id="T12:U329">eye(16,16)</span>-<span class="mxinfo" id="T12:U330"><span class="var type1" id="S27T29U1129">K_e</span>*<span class="var type1" id="S13T28U1130">C2</span></span></span>)*<span class="var type1" id="S29T12U1131">Pm_e</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">    <span class="comment">%Symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">    <span class="mxinfo" id="T12:U334"><span class="var type1" id="S25T12U1134">Pp_ext</span> = <span class="mxinfo" id="T12:U336">(<span class="mxinfo" id="T12:U337"><span class="var type1" id="S25T12U1138">Pp_ext</span>+<span class="mxinfo" id="T12:U339"><span class="var type1" id="S25T12U1140">Pp_ext</span>'</span></span>)/<span class="mxinfo" id="T2:U341">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">    <span class="comment">%xhat_ = xhat_ext;   ??</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">    <span class="mxinfo" id="T30:U342"><span class="var type1" id="S2T30U1144">return_value</span> = <span class="var type1" id="S23T30U1145">xhat_ext</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo" id="T7:U345"><span class="var type1" id="S3T13U1148">option</span> ==<span class="mxinfo" id="T2:U347">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="comment">%update meassurement 16 states</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U348">~<span class="var type1" id="S31T2U1153">init_16</span></span>  <span class="comment">%This might give some very minor input-output delay for first function call</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">                 <span class="comment">%But doesnt let the user make mistakes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="mxinfo" id="T2:U350"><span class="var type1" id="S31T2U1156">init_16</span> = <span class="mxinfo" id="T2:U352">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T7:U353">~<span class="var type1" id="S32T2U1161">init_extended</span></span> <span class="comment">%initalize </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">            <span class="mxinfo" id="T2:U355"><span class="var type1" id="S32T2U1164">init_extended</span> = <span class="mxinfo" id="T2:U357">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">            <span class="mxinfo" id="T30:U358"><span class="var type1" id="S23T30U1168">xhat_ext</span> = <span class="mxinfo" id="T30:U360">zeros(<span class="mxinfo" id="T2:U361">16</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">            <span class="mxinfo" id="T3:U362"><span class="mxinfo" id="T3:U363"><span class="var type1" id="S23T30U1176">xhat_ext</span>(<span class="mxinfo" id="T23:U365"><span class="mxinfo" id="T2:U366">1</span>:<span class="mxinfo" id="T2:U367">10</span></span>)</span> = <span class="var type1" id="S20T23U1180">xhat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">            <span class="comment">% Predictor should be called first.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">            <span class="mxinfo" id="T12:U369"><span class="var type1" id="S25T12U1183">Pp_ext</span> = <span class="mxinfo" id="T12:U371">diag(<span class="mxinfo" id="T11:U372">[1 ,1 ,ones(1,8), 0.5*[1 1], 0.5*[1 1] , [0.1,0.1 ]]</span>)</span></span>; <span class="comment">%initial covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">            <span class="mxinfo" id="T8:U373"><span class="mxinfo" id="T8:U374"><span class="var type1" id="S25T12U1213">Pp_ext</span>(<span class="mxinfo" id="T23:U376"><span class="mxinfo" id="T2:U377">1</span>:<span class="mxinfo" id="T2:U378">10</span></span>,<span class="mxinfo" id="T23:U379"><span class="mxinfo" id="T2:U380">1</span>:<span class="mxinfo" id="T2:U381">10</span></span>)</span> = <span class="var type1" id="S24T8U1220">Pp</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">        <span class="mxinfo" id="T12:U383"><span class="var type1" id="S29T12U1223">Pm_e</span> = <span class="mxinfo" id="T12:U385"><span class="mxinfo" id="T12:U386"><span class="mxinfo" id="T12:U387"><span class="var type1" id="S11T12U1227">Phi2</span>*<span class="var type1" id="S25T12U1228">Pp_ext</span></span>*<span class="var type1" id="S11T12U1230">Phi2</span>'</span>+<span class="var type1" id="S18T12U1231">Q_e</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">        <span class="mxinfo" id="T29:U392"><span class="var type1" id="S27T29U1234">K_e</span> = <span class="mxinfo" id="T29:U394"><span class="mxinfo" id="T29:U395"><span class="var type1" id="S29T12U1237">Pm_e</span>*<span class="var type1" id="S13T28U1239">C2</span>'</span>/(<span class="mxinfo" id="T10:U398"><span class="mxinfo" id="T10:U399"><span class="mxinfo" id="T28:U400"><span class="var type1" id="S13T28U1244">C2</span>*<span class="var type1" id="S29T12U1245">Pm_e</span></span>*<span class="var type1" id="S13T28U1247">C2</span>'</span>+<span class="var type1" id="S19T10U1248">R_e</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">        <span class="mxinfo" id="T30:U405"><span class="var type1" id="S22T30U1251">xhatm_e</span> = <span class="mxinfo" id="T30:U407"><span class="mxinfo" id="T30:U408"><span class="var type1" id="S11T12U1254">Phi2</span>*<span class="var type1" id="S23T30U1255">xhat_ext</span></span>+<span class="mxinfo" id="T30:U411"><span class="var type1" id="S12T29U1257">Gamma2</span>*(<span class="mxinfo" id="T24:U413">[0 0]'-[2.7 4.3]'</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">        <span class="mxinfo" id="T12:U414"><span class="var type1" id="S25T12U1272">Pp_ext</span> = <span class="mxinfo" id="T12:U416">(<span class="mxinfo" id="T12:U417"><span class="mxinfo" id="T12:U418">eye(16,16)</span>-<span class="mxinfo" id="T12:U419"><span class="var type1" id="S27T29U1281">K_e</span>*<span class="var type1" id="S13T28U1282">C2</span></span></span>)*<span class="var type1" id="S29T12U1283">Pm_e</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">    <span class="comment">%Symmetry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        <span class="mxinfo" id="T12:U423"><span class="var type1" id="S25T12U1286">Pp_ext</span> = <span class="mxinfo" id="T12:U425">(<span class="mxinfo" id="T12:U426"><span class="var type1" id="S25T12U1290">Pp_ext</span>+<span class="mxinfo" id="T12:U428"><span class="var type1" id="S25T12U1292">Pp_ext</span>'</span></span>)/<span class="mxinfo" id="T2:U430">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">      <span class="comment">%  xhat_ = xhat_ext;   ??</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">    <span class="mxinfo" id="T30:U431"><span class="var type1" id="S23T30U1296">xhat_ext</span> = <span class="mxinfo" id="T30:U433"><span class="var type1" id="S22T30U1298">xhatm_e</span>+<span class="mxinfo" id="T30:U435"><span class="var type1" id="S27T29U1300">K_e</span>*(<span class="mxinfo" id="T24:U437"><span class="var type1" id="S35T24U1303">y</span>-<span class="mxinfo" id="T24:U439"><span class="var type1" id="S13T28U1305">C2</span>*<span class="var type1" id="S22T30U1306">xhatm_e</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">    <span class="mxinfo" id="T30:U442"><span class="var type1" id="S2T30U1309">return_value</span> = <span class="var type1" id="S23T30U1310">xhat_ext</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="keyword">else</span> <span class="comment">%Shoudlnt happen <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">   <span class="mxinfo" id="T30:U445"><span class="var type1" id="S23T30U1314">xhat_ext</span> = <span class="mxinfo" id="T30:U447"><span class="var type1" id="S22T30U1316">xhatm_e</span>+<span class="mxinfo" id="T30:U449"><span class="var type1" id="S27T29U1318">K_e</span>*(<span class="mxinfo" id="T24:U451"><span class="var type1" id="S35T24U1321">y</span>-<span class="mxinfo" id="T24:U453"><span class="var type1" id="S13T28U1323">C2</span>*<span class="var type1" id="S22T30U1324">xhatm_e</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">   <span class="mxinfo" id="T30:U456"><span class="var type1" id="S2T30U1327">return_value</span> = <span class="var type1" id="S23T30U1328">xhat_ext</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"></span></span>
</pre>
